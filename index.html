<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä½ å–œæ¬¢å–µå—</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RP8QN33JDM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RP8QN33JDM');
</script>
  <style>
    body {
      background-color: black;
      color: #33ff33;
      font-family: monospace;
      margin: 0;
      padding: 1em;
      box-sizing: border-box;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #terminal {
      width: 90vw;
      max-width: 480px;
      height: 80vh;
      display: flex;
      flex-direction: column;
      border: 1px solid #33ff33;
      padding: 0.5em;
      box-sizing: border-box;
    }
    #log {
      flex: 1;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-bottom: 0.5em;
    }
    #input-line {
      display: flex;
    }
    #prompt {
      margin-right: 0.5em;
    }
    #input {
      background: black;
      border: none;
      color: #33ff33;
      font-family: monospace;
      font-size: 1em;
      flex: 1;
      outline: none;
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div id="log">äººç”ŸçœŸæ˜¯å–µå–µåˆå’ªå’ª..</div>
    <div id="input-line">
      <span id="prompt">âœ</span>
      <input id="input" type="text" autofocus autocomplete="off" />
    </div>
  </div>

  <script>
    const MAGIC = "\u200b\u200c\u200d\ufeff";
    const ZERO_WIDTH = ["\u200b", "\u200c", "\u200d", "\ufeff"];
    const VISIBLE = "å–µ";
    let keyAccepted = false;
    let key = "";

    const logBox = document.getElementById("log");
    const inputBox = document.getElementById("input");

    function intToZW(n, length = 10) {
      let result = "";
      for (let i = 0; i < length; i++) {
        result = ZERO_WIDTH[n % 4] + result;
        n = Math.floor(n / 4);
      }
      return result;
    }

    function zwToInt(zwStr) {
      let n = 0;
      for (const ch of zwStr) {
        n = n * 4 + ZERO_WIDTH.indexOf(ch);
      }
      return n;
    }

    function generateKeyShifts(key, length) {
      const codes = Array.from(key).map(c => c.charCodeAt(0));
      return Array.from({ length }, (_, i) => codes[i % codes.length]);
    }

    function appendLog(text) {
      logBox.innerText += "\n" + text;
      logBox.scrollTop = logBox.scrollHeight;
    }

    function handleInput(cmd) {
      appendLog("âœ " + cmd);
      if (!keyAccepted) {
        if (cmd.trim() === "meow") {
          key = "meow";
          keyAccepted = true;
          appendLog("âœ… meowæ­£ç¡®~~ï¼Œå¼€å§‹å–µå–µå–µå–µï¼");
        } else {
          appendLog("âŒ meowé”™è¯¯ï¼ˆè¯·è¾“å…¥ä½ çš„å–µï¼‰");
        }
        return;
      }

      if (cmd.startsWith(MAGIC)) {
        const input = cmd.slice(MAGIC.length);
        const parts = input.split(VISIBLE).slice(1);
        const shifts = generateKeyShifts(key, parts.length);
        let result = "";
        for (let i = 0; i < parts.length; i++) {
          if (parts[i].length < 10) continue;
          const zw = parts[i].slice(0, 10);
          const code = zwToInt(zw);
          result += String.fromCharCode(code - shifts[i]);
        }
        appendLog("ğŸ”“ è§£å–µç»“æœï¼š\n" + result);
      } else {
        const shifts = generateKeyShifts(key, cmd.length);
        let result = MAGIC;
        for (let i = 0; i < cmd.length; i++) {
          const shifted = cmd.charCodeAt(i) + shifts[i];
          const zw = intToZW(shifted);
          result += VISIBLE + zw;
        }
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(result).then(() => {
            appendLog("ğŸ” åŠ meowæˆåŠŸï¼Œç»“æœå·²å¤åˆ¶ï¼");
          }).catch(err => {
            appendLog("âš ï¸ åŠ meowæˆåŠŸä½†å¤åˆ¶å¤±è´¥ï¼š" + err.message);
          });
        } else {
          appendLog("ğŸ” åŠ meowæˆæ‰‹åŠ¨å¤åˆ¶ï¼š\n" + result);
        }
      }
    }

    inputBox.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const cmd = this.value.trim();
        if (cmd === "") return;
        this.value = "";
        try {
          handleInput(cmd);
        } catch (err) {
          appendLog("â— å‡ºé”™äº†ï¼š" + err.message);
        }
      }
    });
  </script>
</body>
</html>

